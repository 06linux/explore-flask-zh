<!DOCTYPE HTML>
<html lang="en-US" manifest="./manifest.appcache">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>环境 | Flask之旅</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="spacewander">
        <meta name="description" content="《explore flask》中文翻译">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="./4-organizing_your_project.html" />
        
        
        <link rel="prev" href="./2-coding_conventions.html" />
        

        <meta property="og:title" content="环境 | Flask之旅">
        <meta property="og:site_name" content="Flask之旅">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/spacewander">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="gitbook/style.css">
        


        
    <div class="book" data-github="spacewander/explore-flask-zh" data-level="3" data-basepath="." data-revision="1412666276503">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/spacewander/explore-flask-zh" target="_blank" class="btn pull-left"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>
    

    
    <a href="https://github.com/spacewander/explore-flask-zh/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/spacewander/explore-flask-zh/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="./" >Flask之旅</a>
    </h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/spacewander" target="blank">About the author</a>
        </li>
        

        
        <li>
            <a href="https://github.com/spacewander/explore-flask-zh/issues" target="blank">Questions and Issues</a>
        </li>
        

        
        <li>
            <a href="https://github.com/spacewander/explore-flask-zh/edit/master/3-environment.md" target="blank">Edit and Contribute</a>
        </li>
        

        
        <li class="divider"></li>
        

        <li data-level="0" data-path="index.html">
            <a href="./"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="1-introduction.html">
                
                <a href="./1-introduction.html">
                    <i class="fa fa-check"></i> <b>1.</b> 前言
                </a>
                
                
            </li>
        
            <li  data-level="2" data-path="2-coding_conventions.html">
                
                <a href="./2-coding_conventions.html">
                    <i class="fa fa-check"></i> <b>2.</b> 代码约定
                </a>
                
                
            </li>
        
            <li  data-level="3" data-path="3-environment.html">
                
                <a href="./3-environment.html">
                    <i class="fa fa-check"></i> <b>3.</b> 环境
                </a>
                
                
            </li>
        
            <li  data-level="4" data-path="4-organizing_your_project.html">
                
                <a href="./4-organizing_your_project.html">
                    <i class="fa fa-check"></i> <b>4.</b> 组织你的项目
                </a>
                
                
            </li>
        
            <li  data-level="5" data-path="5-configuration.html">
                
                <a href="./5-configuration.html">
                    <i class="fa fa-check"></i> <b>5.</b> 配置
                </a>
                
                
            </li>
        
            <li  data-level="6" data-path="6-advanced_patterns_for_views_and_routing.html">
                
                <a href="./6-advanced_patterns_for_views_and_routing.html">
                    <i class="fa fa-check"></i> <b>6.</b> 关于视图和路由的进阶技巧
                </a>
                
                
            </li>
        
            <li  data-level="7" data-path="7-blueprints.html">
                
                <a href="./7-blueprints.html">
                    <i class="fa fa-check"></i> <b>7.</b> 蓝图
                </a>
                
                
            </li>
        
            <li  data-level="8" data-path="8-templates.html">
                
                <a href="./8-templates.html">
                    <i class="fa fa-check"></i> <b>8.</b> 模板
                </a>
                
                
            </li>
        
            <li  data-level="9" data-path="9-static_files.html">
                
                <a href="./9-static_files.html">
                    <i class="fa fa-check"></i> <b>9.</b> 静态文件
                </a>
                
                
            </li>
        
            <li  data-level="10" data-path="10-storing-data.html">
                
                <a href="./10-storing-data.html">
                    <i class="fa fa-check"></i> <b>10.</b> 存储
                </a>
                
                
            </li>
        
            <li  data-level="11" data-path="11-handling_forms.html">
                
                <a href="./11-handling_forms.html">
                    <i class="fa fa-check"></i> <b>11.</b> 处理表单
                </a>
                
                
            </li>
        
            <li  data-level="12" data-path="12-handling_users.html">
                
                <a href="./12-handling_users.html">
                    <i class="fa fa-check"></i> <b>12.</b> 用户管理的规范
                </a>
                
                
            </li>
        
            <li  data-level="13" data-path="14-deployment.html">
                
                <a href="./14-deployment.html">
                    <i class="fa fa-check"></i> <b>13.</b> 部署
                </a>
                
                
            </li>
        

        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 53.84615384615385%;min-width: 46.15384615384615%;"></div>
    </div>
    <div class="chapters">
    
        <a href="./index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="./1-introduction.html" title="前言" class="chapter done new-chapter" data-progress="1" style="left: 7.6923076923076925%;"></a>
    
        <a href="./10-storing-data.html" title="存储" class="chapter done " data-progress="10" style="left: 15.384615384615385%;"></a>
    
        <a href="./11-handling_forms.html" title="处理表单" class="chapter done " data-progress="11" style="left: 23.076923076923077%;"></a>
    
        <a href="./12-handling_users.html" title="用户管理的规范" class="chapter done " data-progress="12" style="left: 30.76923076923077%;"></a>
    
        <a href="./14-deployment.html" title="部署" class="chapter done " data-progress="13" style="left: 38.46153846153846%;"></a>
    
        <a href="./2-coding_conventions.html" title="代码约定" class="chapter done new-chapter" data-progress="2" style="left: 46.15384615384615%;"></a>
    
        <a href="./3-environment.html" title="环境" class="chapter done new-chapter" data-progress="3" style="left: 53.84615384615385%;"></a>
    
        <a href="./4-organizing_your_project.html" title="组织你的项目" class="chapter  new-chapter" data-progress="4" style="left: 61.53846153846154%;"></a>
    
        <a href="./5-configuration.html" title="配置" class="chapter  new-chapter" data-progress="5" style="left: 69.23076923076923%;"></a>
    
        <a href="./6-advanced_patterns_for_views_and_routing.html" title="关于视图和路由的进阶技巧" class="chapter  new-chapter" data-progress="6" style="left: 76.92307692307692%;"></a>
    
        <a href="./7-blueprints.html" title="蓝图" class="chapter  new-chapter" data-progress="7" style="left: 84.61538461538461%;"></a>
    
        <a href="./8-templates.html" title="模板" class="chapter  new-chapter" data-progress="8" style="left: 92.3076923076923%;"></a>
    
        <a href="./9-static_files.html" title="静态文件" class="chapter  new-chapter" data-progress="9" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_8">
                    
                        <p><img src="images/environment.png" alt="环境"></p>
<h1 id="-">环境</h1>
<p>为了正确地跑起来，你的应用需要依赖许多不同的软件。
就算是再怎么否认这一点的人，也无法否认至少需要依赖Flask本身。
你的应用的<strong>运行环境</strong>，在当你想要让它跑起来时，是至关重要的。
幸运的是，我们有许多工具可以减低管理环境的复杂度。</p>
<h2 id="-virtualenv-">使用virtualenv来管理环境</h2>
<p><a href="http://www.virtualenv.org/en/latest/" target="_blank">virtualenv</a>是一个能把你的应用隔离在一个<strong>虚拟环境</strong>中的工具。
一个虚拟环境是一个包含了你的应用依赖的软件的文件夹。一个虚拟环境同时也封存了你在开发时的环境变量。
与其把依赖包，比如Flask，下载到你的系统包管理文件夹，或用户包管理文件夹，我们可以把它下载到对应当前应用的一个隔离的文件夹之下。
这使得你可以指定一个特定的Python二进制版本，取决于当前开发的项目。</p>
<p>virtualenv也可以让你给不同的项目指定同样的依赖包的不同版本。
当你在一个老旧的包含众多不同项目的平台上开发时，这种灵活性十分重要。</p>
<p>When using virtualenv, you&#39;ll generally have only a few Python packages installed globally on your system. One of these will be virtualenv itself:</p>
<p>用了virtualenv，你将只会把少数几个Python模块安装到系统的全局空间中。其中一个会是virtualenv本身：</p>
<pre><code class="lang-sh"># 使用pip安装virtualenv
$ pip install virtualenv
</code></pre>
<p>Then, when you are inside your project directory, you&#39;ll create a new virtual environment with virtualenv:</p>
<p>安装完virtualenv，就可以开始创建虚拟环境。切换到你的项目文件夹，运行<code>virtualenv</code>命令。这个命令接受一个参数，作为虚拟环境的名字（同样也是它的位置，在当前文件夹<code>ls</code>下你就知道了）。</p>
<pre><code class="lang-sh">$ virtualenv venv
New python executable in venv/bin/python
Installing setuptools, pip...done.
</code></pre>
<p>这将创建一个包含所有依赖的文件夹。</p>
<p>一旦新的virtual environment已经准备就绪，你需要给对应的virtual environment下的<code>bin/activate</code>脚本执行<code>source</code>，来激活它。</p>
<pre><code>$ source venv/bin/activate
</code></pre><p>This script makes some changes to your shell&#39;s environment variables so that everything points to the new virtual environment instead of your global system. You can see the effect by running <code>which python</code>; “python” now refers to the Python binary in the virtual environment. When a virtual environment is active, dependencies installed with Pip will be downloaded to that virtual environment instead of the global system.</p>
<p>这个脚本对你的shell的环境变量施加了魔法，让它们指向新的virtual environment而不是你的全局系统环境。
你可以通过运行<code>which python</code>看到：“python”现在指向的是virtual environment中的二进制版本。</p>
<pre><code class="lang-sh">$ which python
/usr/local/bin/python
$ source venv/bin/activate
(venv)$ which python
/Users/robert/Code/myapp/venv/bin/python
</code></pre>
<p>当一个virtual environment被激活了，依赖包会被pip安装到virtual environment中而不是全局系统环境。</p>
<p>你也许注意到了，你的shell提示符发生了改变。
virtualenv在它前面添加了当前被激活的virtual environment，所以你能意识到你并不存在于全局系统环境中。</p>
<p>运行<code>deactivate</code>命令，你就能离开你的virtual environment。</p>
<pre><code>(venv)$ deactivate
$
</code></pre><h2 id="-virtualenvwrapper-virtual-environment">使用virtualenvwrapper管理你的virtual environment</h2>
<p>I didn&#39;t want to mention <strong>virtualenvwrapper</strong> until you had seen the basics of virtualenv. I wanted to make that you understand what virtualenvwrapper is improving upon, so that you’ll understand why you’d want to use it.</p>
<p>在你了解了virtualenv的基本知识后，是时候提及<strong>virtualenvwrapper</strong>了。
我想要让你了解到<a href="http://virtualenvwrapper.readthedocs.org/en/latest/" target="_blank">virtualenvwrapper</a>对于前面的工作做了什么改进，这样你就知道为什么你应该使用它。</p>
<p>虚拟环境文件夹现在已经位于你的项目文件夹之下。
但是你仅仅是在激活了虚拟环境后才会跟它交互。它甚至不应该被放入版本控制中。所以它呆在项目文件夹中也是挺碍眼的。
解决这个问题的一个方法就是使用virtualenvwrapper。这个包把你所有的virtual environment整理到单独的文件夹下，通常是<code>~/.virtualenvs/</code>。</p>
<p>To install virtualenvwrapper, follow the instructions in the documentation [<a href="http://virtualenvwrapper.readthedocs.org/en/latest/" target="_blank">http://virtualenvwrapper.readthedocs.org/en/latest/</a>].</p>
<p>要安装virtualenvwrapper，遵循这个<a href="http://virtualenvwrapper.readthedocs.org/en/latest/" target="_blank">文档</a>中的步骤。</p>
<p>{ WARNING: Make sure that you&#39;ve deactivated all virtual environments before installing virtualenvwrapper. You want it installed globally, not in a pre-existing environment. }</p>
<blockquote>
<p><strong>注意</strong>
确保你在安装virtualenvwrapper时不在任何一个virtual environment中。你需要把它安装在全局空间，而不是一个已存在的virtual environment中</p>
</blockquote>
<p>现在，你不再需要运行<code>virtualenv</code>来创建一个环境，只需运行<code>mkvirtualenv</code>：</p>
<pre><code class="lang-sh">$ mkvirtualenv rocket
New python executable in rocket/bin/python
Installing setuptools, pip...done.
</code></pre>
<p>在你的virtual environment目录之下，比如在<code>~/.virtualenv</code>之下，<code>mkvirtualenv</code>创建了一个文件夹，并替你激活了它。
就像普通的<code>virtualenv</code>，<code>python</code>和<code>pip</code>现在指向的是virtual environment而不是全局系统。
为了激活想要的环境，运行这个命令：<code>workon [environment name]</code>，而<code>deactivate</code>依然会关闭环境。</p>
<h2 id="-">记录依赖变动</h2>
<p>随着项目增长，你会发现它的依赖列表也一并随着增长。在你能运行一个Flask应用之前，即使已经需要数以十记的依赖包也毫不奇怪。
管理依赖的最简单的方法就是使用一个简单的文本文件。
pip可以生成一个文本文件，列出所有已经安装的包。它也可以解析这个文件，并在新的系统（或者新的环境）下安装每一个包。</p>
<h3 id="pip-freeze">pip freeze</h3>
<p><strong>requirements.txt</strong>是一个常常被许多Flask应用用于列出它所依赖的包的文本文件。它是通过<code>pip freeze &gt; requirements.txt</code>生成的。
使用<code>pip install -r requirements.txt</code>，你就能安装所有的包。</p>
<blockquote>
<p><strong>注意</strong>
在freeze或install依赖包时，确保你正为于正确的virtual environment之中。</p>
</blockquote>
<h3 id="-">手动记录依赖变动</h3>
<p>随着项目增长，你可能会发现<code>pip freeze</code>中列出的每一个包并不再是运行应用所必须的了。
也许有些包只是在开发时用得上。<code>pip freeze</code>没有判断力；它只是列出了当前安装的所有的包。所以你只能手动记录依赖的变动了。
你可以把运行应用所需的包和开发应用所需的包分别放入对应的<em>require_run.txt</em>和<em>require_dev.txt</em>。</p>
<h2 id="-">版本控制</h2>
<p>选择一个版本控制系统并使用它。
我推荐Git。如我所知，Git是当下最大众的版本控制系统。
在删除代码的时候无需担忧潜在的巨大灾难是无价的。
你现在可以对过去那种把不要的代码注释掉的行为说拜拜了，因为你可以直接删掉它们，即使将来突然需要，也可以通过<code>git revert</code>来恢复。
另外，你将会有整个项目的备份，存在Github,Bitbucket或你自己的Git server。</p>
<h3 id="-">什么不应该在版本控制里</h3>
<p>I usually keep a file out of version control for one of two reasons. Either it’s clutter, or it’s a secret. Compiled files, e.g. <code>.pyc</code> files and virtual environments (if you’re not using virtualenvwrapper for some reason) are examples of clutter. They don’t need to be in version control because they can be generated from <code>.py</code> files and <code>requirements.txt</code> respectively. API keys, application secret keys, and database credentials are examples of secrets. They shouldn’t be in version control because their exposure would be a massive breach of security.</p>
<p>我通常不把一个文件放在版本控制里，如果它满足以下两个原因中的一个。</p>
<ol>
<li>它是不必要的</li>
<li>它是不公开的。</li>
</ol>
<p>编译的产物，比如<code>.pyc</code>，和virtual environment（如果你因为某些原因没有使用virtualenvwrapper）正是前者的例子。
它们不需要加入到版本控制中，因为它们可以通过<code>.py</code>或<code>requirements.txt</code>生成出来。</p>
<p>接口密钥（调用接口时必须传入的参数），应用密钥，以及数据库证书则是后者的例子。
它们不应该在版本控制中，因为一旦泄密，将造成严重的安全隐患。</p>
<p>{ NOTE: When making security related decisions, I assume that my repository will become public at some point. This means keeping secrets out, and never assuming that a security hole won’t be found because, “Who’s going to guess that they could do that?” }</p>
<blockquote>
<p><strong>注意</strong>
在做安全相关的决定时，我会假设稳定版本库将会在一定程度上被公开。这意味着要清除所有的隐私，并且永不假设一个安全漏洞不会被发现，
因为“谁能想到他们会干出什么事情？”</p>
</blockquote>
<p>在使用Git时，你可以在版本库中创建一个特别的文件名为<em>.gitignore</em>。
在里面，能使用正则表达式来列出对应的文件。任何匹配的文件将被Git所忽略。
我建议你至少在其中加入<code>*.pyc</code>和<code>/instance</code>。instance文件夹中存放着跟你的应用相关的不便公开的配置。</p>
<pre><code>.gitignore:
*.pyc
instance/
</code></pre><blockquote>
<p><strong>参见</strong></p>
<ul>
<li>在这里你可以了解什么是<em>.gitignore</em> : <a href="http://git-scm.com/docs/gitignore" target="_blank">http://git-scm.com/docs/gitignore</a></li>
<li>Flask文档中对instance目录的一段介绍 : <a href="http://flask.pocoo.org/docs/config/#instance-folders" target="_blank">http://flask.pocoo.org/docs/config/#instance-folders</a></li>
</ul>
</blockquote>
<h2 id="-">调试</h2>
<h3 id="-">调试模式</h3>
<p>Flask有一个便利的特性叫做“debug mode”。在你的应用配置中设置<code>debug = True</code>就能启动它。
当它被启动后，服务器会在代码变动之后重新加载，并且一旦发生错误，错误会打印成一个带交互式命令行的调用栈。</p>
<blockquote>
<p><strong>注意</strong>
不要在生产环境中开启debug mode。交互式命令行运行任意的代码输入，如果是在运行中的网站上，这将导致安全上的灾难性后果。</p>
<p><strong>另见</strong></p>
<ul>
<li>阅读一下quickstart页面的debug mode部分 : <a href="http://docs.jinkan.org/docs/flask/quickstart.html#debug-mode" target="_blank">http://docs.jinkan.org/docs/flask/quickstart.html#debug-mode</a></li>
<li>这里有一些关于错误处理，日志记录和使用其他调试工具的信息 : <a href="http://docs.jinkan.org/docs/flask/errorhandling.html" target="_blank">http://docs.jinkan.org/docs/flask/errorhandling.html</a></li>
</ul>
</blockquote>
<h3 id="flask-debugtoolbar">Flask-DebugToolbar</h3>
<p><a href="http://flask-debugtoolbar.readthedocs.org/en/latest/" target="_blank">Flask-DebugToolbar</a> 是用来调试你的应用的另一个得力工具。在debug mode中，它在你的应用中添加了一个侧边条。
这个侧边条会给你提供有关SQL查询，日志，版本，模板，配置和其他有趣的信息。</p>
<h2 id="-">总结</h2>
<ul>
<li>使用virtualenv来打包你的应用的依赖包。</li>
<li>使用virtualenvwrapper来打包你的virtual environment。</li>
<li>使用一个或多个文本文件来记录依赖变化。</li>
<li>使用一个版本控制系统。我推荐Git。</li>
<li>使用.gitignore来排除不必要的或不能公开的东西混进版本控制。</li>
<li>debug mode会在开发时给你有关bug的信息。</li>
<li>Flaks-DebugToolbar拓展将给你有关bug更多的信息。</li>
</ul>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="./2-coding_conventions.html" class="navigation navigation-prev "><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./4-organizing_your_project.html" class="navigation navigation-next "><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
        

    
    <script src="gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
