<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>模板 | Flask之旅</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.1.1">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./9-static_files.html" />
    
    
    <link rel="prev" href="./7-blueprints.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="gitbook/style.css">


        
    <div class="book" data-level="8" data-basepath="." data-revision="1417613147992">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="1-introduction.html">
            
                
                    <a href="./1-introduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         前言
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="2-coding_conventions.html">
            
                
                    <a href="./2-coding_conventions.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         代码约定
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="3-environment.html">
            
                
                    <a href="./3-environment.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         环境
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="4-organizing_your_project.html">
            
                
                    <a href="./4-organizing_your_project.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         组织你的项目
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="5-configuration.html">
            
                
                    <a href="./5-configuration.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         配置
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="6-advanced_patterns_for_views_and_routing.html">
            
                
                    <a href="./6-advanced_patterns_for_views_and_routing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         关于视图和路由的进阶技巧
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="7" data-path="7-blueprints.html">
            
                
                    <a href="./7-blueprints.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                         蓝图
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="8" data-path="8-templates.html">
            
                
                    <a href="./8-templates.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                         模板
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="9" data-path="9-static_files.html">
            
                
                    <a href="./9-static_files.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                         静态文件
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="10" data-path="10-storing-data.html">
            
                
                    <a href="./10-storing-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                         存储
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11" data-path="11-handling_forms.html">
            
                
                    <a href="./11-handling_forms.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                         处理表单
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12" data-path="12-handling_users.html">
            
                
                    <a href="./12-handling_users.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                         用户管理的规范
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13" data-path="14-deployment.html">
            
                
                    <a href="./14-deployment.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                         部署
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Flask之旅</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_13">
                    
                        <p><img src="images/templates.png" alt="模板"></p>
<h1 id="">模板</h1>
<p>尽管Flask并不强迫你使用某个特定的模板语言，它还是默认你会使用Jinja。在Flask社区的大多数开发者使用Jinja，并且我建议你也跟着做。有一些插件允许你用其他模板语言进行替代(比如<a href="http://pythonhosted.org/Flask-Genshi/" target="_blank">Flask-Genshi</a>和<a href="http://pythonhosted.org/Flask-Mako/" target="_blank">Flask-Mako</a>)，但除非你有充分理由（不懂Jinja可不是一个充分的理由！），否则请保持那个默认的选项；这样你会避免浪费很多时间来焦头烂额。</p>
<blockquote>
<p><strong>注意</strong>
几乎所有提及Jinja的资源讲的都是Jinja2。Jinja1确实曾存在过，但在这里我们不会讲到它。当你看到Jinja时，我们讨论的是这个Jinja: <a href="http://jinja.pocoo.org/" target="_blank">http://jinja.pocoo.org/</a></p>
</blockquote>
<h2 id="jinja">Jinja快速入门</h2>
<p><strong>Jinja</strong>文档在解释这门语言的语法和特性这方面做得很棒。在这里我不会啰嗦一遍，但还是会再一次向你强调下面一点：</p>
<blockquote>
<p>Jinja有两种定界符。<code>{% ... %}</code>和<code>{{ ... }}</code>。前者用于执行像for循环或赋值等语句，后者向模板输出一个表达式的结果。</p>
<p><strong>参见</strong>： <a href="http://jinja.pocoo.org/docs/templates/#synopsis" target="_blank">http://jinja.pocoo.org/docs/templates/#synopsis</a></p>
</blockquote>
<h2 id="">怎样组织模板</h2>
<p>所以要将模板放进我们的应用的哪里呢？如果你是从头开始阅读的本文，你可能注意到了Flask在对待你如何组织项目结构的事情上十分随意。模板也不例外。你大概也已经注意到，总会有一个放置文件的推荐位置。记住两点。对于模板，这个最佳位置是放在包文件夹下。</p>
<pre><code>myapp/
    __init__.py
    models.py
    views/
    templates/
    static/
run.py
requirements.txt
</code></pre><p>让我们打开模板文件夹看看。</p>
<pre><code>templates/
    layout.html
    index.html
    about.html
    profile/
        layout.html
        index.html
    photos.html
    admin/
        layout.html
        index.html
        analytics.html
</code></pre><p><strong>模板</strong>的结构平行于对应的路由的结构。对应于路由<em>myapp.com/admin/analytics</em>的模板是<em>templates/admin/analytics.html</em>。这里也有一些额外的模板不会被直接渲染。<em>layout.html</em>文件就是用于被其他模板继承的。</p>
<h2 id="">继承</h2>
<p>就像蝙蝠侠一样，一个组织良好的模板文件夹也离不开继承带来的好处。<strong>基础模板</strong>通常定义了一个适用于所有的<em>子模板</em>的主体结构。在我们的例子里，<em>layout.html</em>是一个基础模板，而其他的<em>html</em>文件都是子模板。</p>
<p>通常，你会有一个顶级的<em>layout.html</em>定义你的应用的主体布局，外加站点的每一个节点也有自己的一个<em>layout.html</em>。如果再看一眼上面的文件夹结构，你会看到一个顶级的<em>myapp/templates/layout.html</em>，以及<em>myapp/templates/profile/layout.html</em>和<em>myapp/templates/admin/layout.html</em>。后两个文件继承并修改第一个文件。</p>
<p>继承是通过<code>{% extends %}</code>和<code>{% block %}</code>标签实现的。在双亲模板中，你可以定义要给子模板处理的block。</p>
<p><em>myapp/templates/layout.html</em></p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
    {% block body %}
        &lt;h1&gt;这个标题在双亲模板中定义&lt;/h1&gt;
    {% endblock %}
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>在子模板中，你可以拓展双亲模板并定义block里面的内容。</p>
<p><em>myapp/templates/index.html</em></p>
<pre><code>{% extends &quot;layout.html&quot; %}
{% block title %}Hello world!{% endblock %}
{% block body %}
    {{ super() }}
    &lt;h2&gt;这个标题在子模板中定义&lt;/h2&gt;
{% endblock %}
</code></pre><p><code>super()</code>函数让我们在子模板里加载双亲模板中这个block的内容。</p>
<blockquote>
<p><strong>参见</strong>
若想了解更多关于继承的内容，请移步到Jinja模板继承方面的文档。
<a href="http://jinja.pocoo.org/docs/templates/#template-inheritance" target="_blank">http://jinja.pocoo.org/docs/templates/#template-inheritance</a></p>
</blockquote>
<h2 id="">创建宏</h2>
<p>凭借将反复出现的代码片段抽象成<strong>宏</strong>，我们可以实现DRY原则（Don&#39;t Repeat Yourself）。在撰写用于应用的导航功能的HTML时，我们可能会需要给“活跃”链接（比如，到当前页面的链接）一个不同的类。如果没有宏，我们将不得不使用一大堆if/else语句来从每个链接中过滤出“活跃”链接。</p>
<p>宏提供了模块化模板代码的一种方式；它们就像是函数一样。让我们看一下如何使用宏来标记活跃链接。</p>
<p>myapp/templates/layout.html</p>
<pre><code>{% from &quot;macros.html&quot; import nav_link with context %}
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
    {% block head %}
        &lt;title&gt;我的应用&lt;/title&gt;
    {% endblock %}
    &lt;/head&gt;
    &lt;body&gt;
        &lt;ul class=&quot;nav-list&quot;&gt;
            {{ nav_link(&#39;home&#39;, &#39;Home&#39;) }}
            {{ nav_link(&#39;about&#39;, &#39;About&#39;) }}
            {{ nav_link(&#39;contact&#39;, &#39;Get in touch&#39;) }}
        &lt;/ul&gt;
    {% block body %}
    {% endblock %}
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>现在我们调用了一个尚未定义的宏 - <code>nav_link</code> - 并传递两个参数给它：一个目标（比如目标视图的函数名）和我们想要展示的文本。</p>
<blockquote>
<p><strong>注意</strong>
你可能注意到了我们在import语句中加入了<strong>with context</strong>。Jinja的<strong>上下文(context)</strong>包括了通过<code>render_template()</code>函数传递的参数以及在我们的Python代码的Jinja环境上下文。这些变量能够被用于模板的渲染。</p>
<p>一些变量是我们显式传递过去的，比如<code>render_template(&quot;index.html&quot;, color=&quot;red&quot;)</code>，但还有些变量和函数是Flask自动加入到上下文的，比如<code>request</code>，<code>g</code>和<code>session</code>。使用了<code>{% from ... import ... with context %}</code>，我们告诉Jinja让所有的变量也在宏里可用。</p>
<p><strong>参见</strong></p>
<ul>
<li>所有的全局变量都是由Flask传递给Jinja上下文的: <a href="http://flask.pocoo.org/docs/templating/#standard-context" target="_blank">http://flask.pocoo.org/docs/templating/#standard-context</a></li>
<li>通过上下文处理器（context processors），我们可以增加传递给Jinja上下文的变量和函数: <a href="http://flask.pocoo.org/docs/templating/#context-processors" target="_blank">http://flask.pocoo.org/docs/templating/#context-processors</a> </li>
</ul>
</blockquote>
<p>是时候定义模板中用的<code>nav_link</code>宏了。</p>
<p>myapp/templates/macros.html</p>
<pre><code>{% macro nav_link(endpoint, text) %}
{% if request.endpoint.endswith(endpoint) %}
    &lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;{{ url_for(endpoint) }}&quot;&gt;{{text}}&lt;/a&gt;&lt;/li&gt;
{% else %}
    &lt;li&gt;&lt;a href=&quot;{{ url_for(endpoint) }}&quot;&gt;{{text}}&lt;/a&gt;&lt;/li&gt;
{% endif %}
{% endmacro %}
</code></pre><p>现在我们已经在<em>myapp/templates/macros.html</em>中定义了一个宏。我们所做的，就是使用Flask的<code>request</code>对象 - 默认在Jinja上下文中可用 - 来检查当前路由是否是传递给<code>nav_link</code>的那个路由参数。如果是，我们就在目标链接指向的页面上，于是可以标记它为活跃的。</p>
<blockquote>
<p><strong>注意</strong>
<code>from x import y</code>语句中要求x是相对于y的相对路径。如果我们的模板位于<em>myapp/templates/user/blog.html</em>，我们需要使用<code>from &quot;../macros.html&quot; import nav_link with context</code>。</p>
</blockquote>
<h2 id="">自定义过滤器</h2>
<p>Jinja过滤器是在渲染成模板之前，作用于<code>{{ ... }}</code>中的表达式的值的函数。</p>
<pre><code>&lt;h2&gt;{{ article.title|title }}&lt;/h2&gt;
</code></pre><p>在这个代码中，<code>title</code>过滤器接受<code>article.title</code>并返回一个标题格式的文本，用于输出到模板中。它的语法，以及功能，皆一如Unix中修改程序输出的“管道”一样。</p>
<blockquote>
<p><strong>参见</strong>
除了<code>title</code>，还有许许多多别的内建的过滤器。在这里可以看到完整的列表： <a href="http://jinja.pocoo.org/docs/templates/#builtin-filters" target="_blank">http://jinja.pocoo.org/docs/templates/#builtin-filters</a></p>
</blockquote>
<p>我们可以自定义用于Jinja模板的过滤器。作为例子，我们将实现一个简单的<code>caps</code>过滤器来使字符串中所有的字母大写。</p>
<blockquote>
<p><strong>注意</strong>
Jinja已经有一个<code>upper</code>过滤器能实现这一点，还有一个<code>capitalize</code>过滤器能大写第一个字符并小写剩余字符。这些过滤器还能处理Unicode转换，不过我们的这个例子将只专注于阐述相关概念。</p>
</blockquote>
<p>我们将在<em>myapp/util/filters.py</em>中定义我们的过滤器。这个<code>util</code>包可以用来放置各种杂项。</p>
<p>myapp/util/filters.py</p>
<pre><code>from .. import app

@app.template_filter()
def caps(text):
    &quot;&quot;&quot;Convert a string to all caps.&quot;&quot;&quot;
    return text.uppercase()
</code></pre><p>在上面的代码中，通过<code>@app.template_filter()</code>装饰器，我们能将某个函数注册成Jinja过滤器。默认的过滤器名字就是函数的名字，但是通过传递一个参数给装饰器，你可以改变它：</p>
<pre><code>@app.template_filter(&#39;make_caps&#39;)
def caps(text):
    &quot;&quot;&quot;Convert a string to all caps.&quot;&quot;&quot;
    return text.uppercase()
</code></pre><p>现在我们可以在模板中调用<code>make_caps</code>而不是<code>caps</code>：<code>{{ &quot;hello world!&quot;|make_caps }}</code>。</p>
<p>为了让我们的过滤器在模板中可用，我们仅需要在顶级<em><strong>init</strong>.py</em>中import它。</p>
<p>myapp/<strong>init</strong>.py</p>
<pre><code># 确保app已经被初始化以免导致循环import
from .util import filters
</code></pre><h2 id="">总结</h2>
<ul>
<li>使用Jinja作为模板语言。</li>
<li>Jinja有两种定界符：<code>{% ... %}</code>和<code>{{ ... }}</code>。前者用于执行类似循环或赋值的语句，后者向模板输出表达式求值的结果。</li>
<li>模板应该放在<em>myapp/templates/</em> - 一个在应用文件夹里面的目录。</li>
<li>我建议<em>template/</em>文件夹的结构应该与应用URL结构一一对应。</li>
<li>你应该在<em>myapp/templates</em>以及站点的每一部分放置一个<em>layout.html</em>作为布局模板。后者是前者的拓展。</li>
<li>可以用模板语言写类似于函数的宏。</li>
<li>可以用Python代码写应用在模板中的过滤器函数。</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./7-blueprints.html" class="navigation navigation-prev " aria-label="Previous page: 蓝图"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./9-static_files.html" class="navigation navigation-next " aria-label="Next page: 静态文件"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
